(function(){var DataStorage,Search,displayResults,formSubmission,getParams,q,searchForm,search_instance,__indexOf=[].indexOf||function(t){for(var e=0,a=this.length;a>e;e++)if(e in this&&this[e]===t)return e;return-1};Array.prototype.unique=function(){var t,e,a,r,s,o;for(e={},t=r=0,s=this.length;s>=0?s>r:r>s;t=s>=0?++r:--r)e[this[t]]=this[t];o=[];for(t in e)a=e[t],o.push(a);return o},DataStorage=function(){function DataStorage(){this._available_storages=[],this._check_storage_availability(),this._storage=this._available_storages[0]}return DataStorage.prototype.available=function(){return void 0!==this._storage},DataStorage.prototype["delete"]=function(key){return this.available?eval(this._storage).removeItem(key):!1},DataStorage.prototype.get=function(key){var contents;return this.available?(contents=eval(this._storage).getItem(key))?(contents=JSON.parse(contents),contents.ttl<(new Date).getTime()?(this["delete"](key),null):contents.value):null:!1},DataStorage.prototype.save=function(key,value,ttl){var expiration_time;return null==ttl&&(ttl=7200),this.available?(expiration_time=(new Date).getTime()+1e3*ttl,eval(this._storage).setItem(key,JSON.stringify({ttl:expiration_time,value:value}))):!1},DataStorage.prototype._check_storage_availability=function(){return this._local_storage_available()&&this._available_storages.push("localStorage"),this._session_storage_available()?this._available_storages.push("sessionStorage"):void 0},DataStorage.prototype._local_storage_available=function(){var t;try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return t=e,!1}},DataStorage.prototype._session_storage_available=function(){var t;try{return sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),!0}catch(e){return t=e,!1}},DataStorage}(),("undefined"!=typeof exports&&null!==exports?exports:this).DataStorage=new DataStorage,Search=function(){function t(){this._store=new DataStorage}return t.prototype._ary_intersection=function(t,e){var a,r,s,o,n;for(t.length>e.length&&(o=[e,t],t=o[0],e=o[1]),n=[],r=0,s=t.length;s>r;r++)a=t[r],__indexOf.call(e,a)>=0&&n.push(a);return n},t.prototype._data=function(){var t,e;return void 0!==this._data_cache?this._data_cache:this._store.available&&(e=this._store.get("search_index"))?this._data_cache=e:(t=new XMLHttpRequest,t.open("GET","/api/v1/search_index.json",!1),t.send(null),200===t.status&&(this._data_cache=JSON.parse(t.responseText),this._store.available&&this._store.save("search_index",this._data_cache)),this._data_cache)},t.prototype._extract_prefix=function(t){var e;return e=t.match(/([+-]?)(\w+)/),[e[2],e[1]]},t.prototype._extract_terms=function(t){var e,a,r,s,o,n,i,l;for(a={unwanted:[],required:[],optional:[]},o=t.toLowerCase().match(/[+-]?[a-z'-]+/g),n=0,i=o.length;i>n;n++)r=o[n],l=this._extract_prefix(r),s=l[0],e=l[1],this._valid_term(s)?("+"===e&&a.required.push(s),"-"===e&&a.unwanted.push(s),""===e&&a.optional.push(s)):"+"===e&&console.log("Removing required term "+s+" as it would result in no matches.");return a},t.prototype._keywords=function(){return void 0!==this._keywords_cache?this._keywords_cache:this._keywords_cache=Object.keys(this._data().weights)},t.prototype._terms_to_pages=function(t){var e,a,r,s;for(s=[],a=0,r=t.length;r>a;a++)e=t[a],s.push(this._data().weights[e]);return s},t.prototype._valid_term=function(t){return this._keywords().indexOf(t)>=0},t.prototype.query=function(t){var e,a,r,s,o,n,i,l,h,u,c,_,p;if(!this._data())return console.log("The search index is unavailable."),!1;for(o=this._extract_terms(t),a=this._weight_term_list(o.optional),s=this._weight_term_list(o.required,2),n=this._weight_term_list(o.unwanted,-2),e={},_=[a,s,n],l=0,u=_.length;u>l;l++)for(i=_[l],p=Object.keys(i),h=0,c=p.length;c>h;h++)r=p[h],void 0===e[r]&&(e[r]=0),e[r]+=i[r];return this._sort_results(this._weight_list_to_results(e))},t.prototype._sort_results=function(t){return t.sort(function(){return function(t,e){return e.weight-t.weight}}(this))},t.prototype._weight_list_to_results=function(t){var e,a,r,s,o,n;for(r=[],n=Object.keys(t),s=0,o=n.length;o>s;s++)e=n[s],t[e]>0&&(a=this._data().pages[e],a.weight=t[e],a.page_id=e,r.push(a));return r},t.prototype._weight_term_list=function(t,e){var a,r,s,o,n,i,l,h;for(null==e&&(e=1),r={},o=0,i=t.length;i>o;o++)for(s=t[o],h=Object.keys(this._data().weights[s]),n=0,l=h.length;l>n;n++)a=h[n],void 0===r[a]&&(r[a]=0),r[a]+=this._data().weights[s][a]*e;return r},t}(),search_instance=new Search,displayResults=function(t,e,a){var r,s,o,n,i,l,h,u,c;for(null==a&&(a=!0),l=document.getElementById("results"),l.innerHTML="",s=document.createElement("ul"),h=document.createElement("h2"),h.innerText="Search Results for "+t,l.appendChild(h),u=0,c=e.length;c>u;u++)i=e[u],r=document.createElement("li"),r.innerHTML="<a href='"+i.path+"' data-weight='"+i.weight+"'>"+i.title+"</a>",s.appendChild(r);return o="Search Results for "+t+" - Stelfox Athen&#xe6;um",n=""+window.location.protocol+"//"+window.location.host+window.location.pathname+"?q="+encodeURIComponent(t),a&&window.history.pushState({query:t,results:e},o,n),document.title=o,l.appendChild(s)},formSubmission=function(t){var e;return e=t.target.q.value,displayResults(e,search_instance.query(e)),t.preventDefault()},getParams=function(){var t,e,a,r,s,o,n,i,l;for(a=window.location.search.substring(1),r=a.split("&"),e={},n=0,i=r.length;i>n;n++)s=r[n],l=s.split("="),t=l[0],o=l[1],e[t]=decodeURIComponent(o);return e},searchForm=document.getElementById("search"),searchForm.addEventListener("submit",formSubmission,!1),void 0!==getParams().q&&(q=searchForm.q.value=getParams().q,displayResults(q,search_instance.query(q))),window.onpopstate=function(t){return t.state?(searchForm.q.value=t.state.query,displayResults(t.state.query,t.state.results,!1)):void 0}}).call(this);