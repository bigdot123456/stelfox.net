<!DOCTYPE html>
<html lang='en_US'>
  <head>
    <title>Openstack - Stelfox Athen&#xe6;um</title>

    <meta http-equiv='content-type' content='text/html; charset=utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1' />
    
    

    <link rel="alternate" type="application/atom+xml" title="Stelfox Athen&#xe6;um Feed" href="/atom.xml" />
    <link rel="canonical" href="https://stelfox.net" />
    <link rel="author" href="https://plus.google.com/+SamStelfox31337/"/>

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Openstack" />
    <meta property="og:url" content="https://stelfox.net/knowledge_base/linux/openstack/" />
    <meta property="og:site_name" content="Stelfox Athen&#xe6;um" />
    <meta property="article:publisher" content="https://www.facebook.com/sstelfox" />
    <meta property="og:image" content="https://stelfox.net/static/avatar-01.jpg" />

    <link rel='stylesheet' href="//fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Alegreya+SC:700" />
    <link rel="stylesheet" href="https://stelfox.net/css/3HrCRVwL3Gos2V4HzXAw/Om/nxs=.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-32188490-1', 'stelfox.net');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header class='masthead'>
      <div class='masthead-inner'>
        <h1><a href='/' title='Home'>Sam Stelfox</a></h1>
        <p class='lead'>Thoughts from a systems hacker and developer.</p>
        <nav>
          <ul>
            <li><a href="/about/" title="About">About</a></li>
            <li><a href="/blog/" title="Blog">Blog</a></li>
            <li><a href="/knowledge_base/" title="Knowledge Base">Knowledge Base</a></li>
            <li><form action="/search/" method="get"><input type="search" name="q" placeholder="Search" /></form></li>
          </ul>
        </nav>
        <footer class='colophon'>
          <p>&copy; 2014, All rights reserved.</p>
        </footer>
      </div>
    </header>
    <div class='content container'>
      <h1>Openstack</h1>

<p>This is a mostly (95%) script-less installation and setup of OpenStack from
scratch on a single host, though done in a way that the services could each be
very easily broken out on to their own machines or multiple machines.</p>

<p>A few references that I&#39;ve used generally for assistance figuring out what I
need:</p>

<ul>
<li><a href="http://docs.openstack.org/essex/openstack-compute/install/yum/content/compute-system-requirements.html">http://docs.openstack.org/essex/openstack-compute/install/yum/content/compute-system-requirements.html</a></li>
<li><a href="http://fedoraproject.org/wiki/Getting_started_with_OpenStack_on_Fedora_17">http://fedoraproject.org/wiki/Getting_started_with_OpenStack_on_Fedora_17</a></li>
<li><code>http://docs.openstack.org/trunk/openstack-compute/admin/content/configuration-qpid.html</code> (Dead link)</li>
<li><a href="https://cwiki.apache.org/qpid/qpid-design-configuration.html">https://cwiki.apache.org/qpid/qpid-design-configuration.html</a></li>
<li><a href="http://wiki.openstack.org/QpidSupport">http://wiki.openstack.org/QpidSupport</a></li>
<li><a href="https://github.com/mseknibilel/OpenStack-Folsom-Install-guide/blob/master/OpenStack_Folsom_Install_Guide_WebVersion.rst">https://github.com/mseknibilel/OpenStack-Folsom-Install-guide/blob/master/OpenStack_Folsom_Install_Guide_WebVersion.rst</a></li>
<li><a href="https://github.com/openstack/keystone/blob/master/etc/keystone.conf.sample">https://github.com/openstack/keystone/blob/master/etc/keystone.conf.sample</a></li>
<li><a href="http://docs.openstack.org/developer/keystone/configuration.html">http://docs.openstack.org/developer/keystone/configuration.html</a></li>
</ul>

<h2>Installation</h2>

<p>This guide and all the other OpenStack sections on this wiki were written using
the pre-packaged version of OpenStack that comes with Fedora (version 2012.1.3
Essex) any other version may have different configuration options, and
different command line flags.</p>

<p>The various services should be configured in the order of the sections listed
here.</p>

<h3>Network Setup</h3>

<p>For the sake of knowing exactly what is going, what connections are being made
and between what services I&#39;ve elected to put every individual service on it&#39;s
own IP address. This separation also makes it easy to break individual services
off on to other machines if they become a bottleneck and need a more
distributed setup.</p>

<p>Since this was initially done on a development machine I also created a bridge
to act as a virtual ethernet adapter that was only available locally named
<code>br-mgmt</code> which also hosts all of the service&#39;s. The address range chosen for
this development test was <code>10.100.0.0/24</code> as it generally doesn&#39;t interfere
with any networks I normally encounter.</p>

<p>The main bridge was setup using the following configuration file which was
written to <code>/etc/sysconfig/network-scripts/ifcfg-br-mgmt</code>.</p>
<div class="CodeRay">
  <div class="code"><pre>NM_CONTROLLED=no
ONBOOT=yes
TYPE=Bridge
BOOTPROTO=static

IPADDR=10.100.0.10
NETMASK=255.255.255.0
NETWORK=10.100.0.0
BROADCAST=10.100.0.255

IPV6INIT=yes
IPV6_PRIVACY=rfc3041

NAME=ManagementNet
</pre></div>
</div>

<p>Subsequent IP addresses were added to the bridge by creating files at
<code>/etc/sysconfig/network-scripts/ifcfg-br-mgmt:{id}</code> replacing {id} with 1
through 9 with the following contents:</p>
<div class="CodeRay">
  <div class="code"><pre>DEVICE={Interface Name}
NM_CONTROLLED=no
ONBOOT=yes
BOOTPROTO=static

IPADDR={IP Address}
NETMASK=255.255.255.0

IPV6INIT=yes
IPV6_PRIVACY=rfc3041

NAME={Service}
</pre></div>
</div>

<p>The following table show the address allocations I used, and what I intend the
address be used for:</p>

<table><thead>
<tr>
<th>Interface Name</th>
<th>IP Address</th>
<th>Service</th>
</tr>
</thead><tbody>
<tr>
<td>br-mgmt:1</td>
<td>10.100.0.11</td>
<td>MySQLd</td>
</tr>
<tr>
<td>br-mgmt:2</td>
<td>10.100.0.12</td>
<td>Qpidd</td>
</tr>
<tr>
<td>br-mgmt:3</td>
<td>10.100.0.13</td>
<td>Keystone/Identity</td>
</tr>
<tr>
<td>br-mgmt:4</td>
<td>10.100.0.14</td>
<td>Memcached</td>
</tr>
<tr>
<td>br-mgmt:5</td>
<td>10.100.0.15</td>
<td>Nova/Compute</td>
</tr>
<tr>
<td>br-mgmt:6</td>
<td>10.100.0.16</td>
<td>Cinder/Volume</td>
</tr>
<tr>
<td>br-mgmt:7</td>
<td>10.100.0.17</td>
<td>Glance/Image</td>
</tr>
<tr>
<td>br-mgmt:8</td>
<td>10.100.0.18</td>
<td>EC2</td>
</tr>
<tr>
<td>br-mgmt:9</td>
<td>10.100.0.19</td>
<td>Quantum/Network</td>
</tr>
</tbody></table>

<h3>Service Pre-Requisites</h3>

<p>When configuring the following service be sure to bind them to the address
listed in the table above in the Service/Management network section.</p>

<ul>
<li>Install <a href="../mysql/">Mysql Server</a></li>
<li>Install <a href="../qpid/">Qpid Message Broker</a></li>
<li>Install <a href="../chronyd/">Chrony NTP Server</a></li>
<li>Install <a href="../memcached/">Memcache</a></li>
</ul>

<h3>Keystone/Identity</h3>

<p>Keystone is the OpenStack Identity service and it&#39;s configuration is documented
on <a href="../openstack_keystone/">it&#39;s wiki page</a>.</p>

<h3>Glance/Image Service</h3>

<p>Glance is the OpenStack Image service and it&#39;s configuration is documented on
<a href="../openstack_glance/">it&#39;s wiki page</a></p>

<h3>Horizon/Dashboard</h3>

<p>Notes for when I get to this:</p>

<p>I should make use of the Cached Database session backend:</p>

<ul>
<li><a href="http://docs.openstack.org/trunk/openstack-compute/install/apt/content/dashboard-session-cached-database.html">http://docs.openstack.org/trunk/openstack-compute/install/apt/content/dashboard-session-cached-database.html</a></li>
</ul>

<p>It will need to have memcache configured as if it was going to be the session
storage:</p>

<ul>
<li><a href="http://docs.openstack.org/trunk/openstack-compute/install/apt/content/dashboard-session-memcache.html">http://docs.openstack.org/trunk/openstack-compute/install/apt/content/dashboard-session-memcache.html</a></li>
</ul>

<p>Additional notes:</p>

<ul>
<li><code>http://docs.openstack.org/trunk/openstack-object-storage/admin/content/memcached-considerations.html</code> (Dead link)</li>
<li><a href="http://www.cybera.ca/tech-radar/using-memcached-openstack-nova">http://www.cybera.ca/tech-radar/using-memcached-openstack-nova</a></li>
</ul>

    </div>
  </body>
</html>
