<!DOCTYPE html>
<html lang='en_US'>
  <head>
    <title>Gitorious - Stelfox Athen&#xe6;um</title>

    <meta http-equiv='content-type' content='text/html; charset=utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1' />
    
    

    <link rel="alternate" type="application/atom+xml" title="Stelfox Athen&#xe6;um Feed" href="/atom.xml" />
    <link rel="canonical" href="https://stelfox.net" />
    <link rel="author" href="https://plus.google.com/+SamStelfox31337/"/>

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Gitorious" />
    <meta property="og:url" content="https://stelfox.net/knowledge_base/linux/gitorious/" />
    <meta property="og:site_name" content="Stelfox Athen&#xe6;um" />
    <meta property="article:publisher" content="https://www.facebook.com/sstelfox" />
    <meta property="og:image" content="https://stelfox.net/static/avatar-01.jpg" />

    <meta name="go-import" content="stelfox.net git https://io.stelfox.net/" />

    <link rel='stylesheet' href="//fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Alegreya+SC:700" />
    <link rel="stylesheet" href="https://stelfox.net/css/3HrCRVwL3Gos2V4HzXAw/Om/nxs=.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-32188490-1', 'stelfox.net');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header class='masthead'>
      <div class='masthead-inner'>
        <h1><a href='/' title='Home'>Sam Stelfox</a></h1>
        <p class='lead'>Thoughts from a systems hacker and developer.</p>
        <nav>
          <ul>
            <li><a href="/about/" title="About">About</a></li>
            <li><a href="/blog/" title="Blog">Blog</a></li>
            <li><a href="/knowledge_base/" title="Knowledge Base">Knowledge Base</a></li>
            <li><form action="/search/" method="get"><input type="search" name="q" placeholder="Search" /></form></li>
          </ul>
        </nav>
        <footer class='colophon'>
          <p>&copy; 2014, All rights reserved.</p>
        </footer>
      </div>
    </header>
    <div class='content container'>
      <h1>Gitorious</h1>

<h2>Initial Setup</h2>

<ul>
<li>Create a new shell account</li>
<li>Created new dreamhost domain &quot;git.example.org&quot; with passenger enabled</li>
<li>Created new database for the gitorious site, added gitorious mysql user</li>
<li>Waited for dreamhost to create site</li>
<li>Added IPv6 address for the domain (optional)</li>
</ul>

<p>Create a directory for the repositories, and tarballs to live:</p>
<div class="CodeRay">
  <div class="code"><pre>mkdir ~/.repositories ~/.git-tarballs ~/.git-tarballs-work
</pre></div>
</div>
<div class="CodeRay">
  <div class="code"><pre>rm -rf git.example.org
git clone git://gitorious.org/gitorious/mainline.git git.example.org
cd git.example.org
git submodule update --init
</pre></div>
</div>

<p>Copy the sample configurations into place...</p>
<div class="CodeRay">
  <div class="code"><pre>cp config/database.sample.yml config/database.yml
cp config/broker.yml.example config/broker.yml
cp config/gitorious.sample.yml config/gitorious.yml
</pre></div>
</div>

<p>Change <code>config/database.yml</code> to be:</p>
<div class="CodeRay">
  <div class="code"><pre><span class="key">development</span>:
  <span class="key">adapter</span>: <span class="string"><span class="content">sqlite3</span></span>
  <span class="key">database</span>: <span class="string"><span class="content">db/development.db</span></span>
  <span class="key">pool</span>: <span class="string"><span class="content">5</span></span>
  <span class="key">timeout</span>: <span class="string"><span class="content">5000</span></span>
  <span class="key">encoding</span>: <span class="string"><span class="content">utf8</span></span>
<span class="key">test</span>:
  <span class="key">adapter</span>: <span class="string"><span class="content">sqlite3</span></span>
  <span class="key">database</span>: <span class="string"><span class="content">db/test.db</span></span>
  <span class="key">pool</span>: <span class="string"><span class="content">5</span></span>
  <span class="key">timeout</span>: <span class="string"><span class="content">5000</span></span>
  <span class="key">encoding</span>: <span class="string"><span class="content">utf8</span></span>
<span class="key">production</span>:
  <span class="key">adapter</span>: <span class="string"><span class="content">mysql</span></span>
  <span class="key">database</span>: <span class="string"><span class="content">databasename</span></span>
  <span class="key">username</span>: <span class="string"><span class="content">databaseuser</span></span>
  <span class="key">password</span>: <span class="string"><span class="content">databasepass</span></span>
  <span class="key">host</span>: <span class="string"><span class="content">databasehost</span></span>
  <span class="key">encoding</span>: <span class="string"><span class="content">utf8</span></span>
</pre></div>
</div>

<p>Make sure to update production with the connection information for your
database.</p>

<p>You&#39;ll want to collect a few pieces of information for the next config file:</p>

<ul>
<li>Hostname of the server (The example uses git.stelfox.net)</li>
<li>Server&#39;s SSH fingerprint (guide uses
&quot;7e:af:8d:ec:f0:39:5e:ba:52:16:ce:19:fa:d4:b8:7d&quot; the default), if you&#39;ve
SSH&#39;d to it from where you are you can look up it&#39;s fingerprint like so:

<ul>
<li><code>ssh-keygen -l -F git.example.org</code></li>
</ul></li>
<li>Full path to where the repositories will live (following this guide it will
be <code>/home/&lt;username&gt;/.repositories</code></li>
<li>Full path for tar ball work directories (following this guide it will be
<code>/home/&lt;username&gt;/.git-tarballs</code> and <code>/home/&lt;username&gt;/.git-tarballs-work</code></li>
<li>User&#39;s email to receive exception notifications (probably your email, this
guide uses <a href="mailto:me@example.org">me@example.org</a>)</li>
<li>What email address you want support requests to arrive at (This guide uses
<a href="mailto:support@example.org">support@example.org</a>)</li>
</ul>
<div class="CodeRay">
  <div class="code"><pre><span class="key">production</span>:
  <span class="key">gitorious_client_port</span>: <span class="string"><span class="content">80</span></span>
  <span class="key">gitorious_client_host</span>: <span class="string"><span class="content">git.example.org</span></span>
  <span class="key">gitorious_host</span>: <span class="string"><span class="content">git.example.org</span></span>

  <span class="key">repository_base_path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/home/&lt;username&gt;/.repositories</span><span class="delimiter">&quot;</span></span>
  <span class="key">archive_cache_dir</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/home/&lt;username&gt;/.git-tarballs</span><span class="delimiter">&quot;</span></span>
  <span class="key">archive_work_dir</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/home/&lt;username&gt;/.git-tarballs-work</span><span class="delimiter">&quot;</span></span>

  <span class="key">cookie_secret</span>: <span class="comment"># Generate random 64 character string for this</span>
  <span class="key">use_ssl</span>: <span class="string"><span class="content">false</span></span>

  <span class="key">gitorious_user</span>: <span class="string"><span class="content">&lt;username&gt;</span></span>
  <span class="key">exception_notification_emails</span>: <span class="string"><span class="content">me@example.org</span></span>

  <span class="comment"># IMPORTANT: &quot;sync&quot; doesn't require a daemon to run (which is needed on</span>
  <span class="comment"># shared hosting)</span>
  <span class="key">messaging_adapter</span>: <span class="string"><span class="content">sync</span></span>

  <span class="key">disable_record_throttling</span>: <span class="string"><span class="content">false</span></span>
  <span class="key">merge_request_diff_timeout</span>: <span class="string"><span class="content">10</span></span>

  <span class="key">public_mode</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">enable_private_repositories</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">only_site_admins_can_create_projects</span>: <span class="string"><span class="content">true</span></span>

  <span class="comment"># System message that will appear on all pages if present</span>
  <span class="key">system_message</span>:

  <span class="key">locale</span>: <span class="string"><span class="content">en</span></span>

  <span class="key">hide_http_clone_urls</span>: <span class="string"><span class="content">false</span></span>
  <span class="key">hide_git_clone_urls</span>: <span class="string"><span class="content">false</span></span>

  <span class="comment"># Is this gitorious.org? Read: should we have a very flashy homepage?</span>
  <span class="comment">#is_gitorious_dot_org: true</span>

  <span class="comment"># Configure which address to use as From when sending email</span>
  <span class="key">sender_email_address</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gitorious &lt;no-reply@git.example.org&gt;</span><span class="delimiter">&quot;</span></span>

  <span class="comment"># Mangle visible e-mail addresses (spam protection)</span>
  <span class="key">mangle_email_addresses</span>: <span class="string"><span class="content">true</span></span>

  <span class="comment"># Available project licenses.</span>
  <span class="key">licenses</span>:
    - <span class="string"><span class="content">Academic Free License v3.0</span></span>
    - <span class="string"><span class="content">MIT License</span></span>
    - <span class="string"><span class="content">BSD License</span></span>
    - <span class="string"><span class="content">Ruby License</span></span>
    - <span class="string"><span class="content">GNU General Public License version 2 (GPLv2)</span></span>
    - <span class="string"><span class="content">GNU General Public License version 3 (GPLv3)</span></span>
    - <span class="string"><span class="content">GNU Lesser General Public License (LGPL)</span></span>
    - <span class="string"><span class="content">GNU Affero General Public License (AGPLv3)</span></span>
    - <span class="string"><span class="content">Mozilla Public License 1.0 (MPL)</span></span>
    - <span class="string"><span class="content">Mozilla Public License 1.1 (MPL 1.1)</span></span>
    - <span class="string"><span class="content">Qt Public License (QPL)</span></span>
    - <span class="string"><span class="content">Python License</span></span>
    - <span class="string"><span class="content">zlib/libpng License</span></span>
    - <span class="string"><span class="content">Apache License</span></span>
    - <span class="string"><span class="content">Apple Public Source License</span></span>
    - <span class="string"><span class="content">Perl Artistic License</span></span>
    - <span class="string"><span class="content">Microsoft Permissive License (Ms-PL)</span></span>
    - <span class="string"><span class="content">ISC License</span></span>
    - <span class="string"><span class="content">Lisp Lesser License</span></span>
    - <span class="string"><span class="content">Boost Software License</span></span>
    - <span class="string"><span class="content">Public Domain</span></span>
    - <span class="string"><span class="content">Other Open Source Initiative Approved License</span></span>
    - <span class="string"><span class="content">Other/Proprietary License</span></span>
    - <span class="string"><span class="content">Other/Multiple</span></span>
    - <span class="string"><span class="content">None</span></span>

  <span class="key">default_license</span>: <span class="string"><span class="content">MIT License</span></span>

  <span class="comment"># Stuff that's in the html &lt;head&gt;. custom stats javascript code etc</span>
  <span class="comment">#extra_html_head_data:</span>

  <span class="comment"># Email address to the support for the Gitorious server</span>
  <span class="key">gitorious_support_email</span>: <span class="string"><span class="content">support@example.org</span></span>
  <span class="key">ssh_fingerprint</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">7e:af:8d:ec:f0:39:5e:ba:52:16:ce:19:fa:d4:b8:7d</span><span class="delimiter">&quot;</span></span>

  <span class="key">additional_footer_links</span>:
    - <span class="string"><span class="content">- My Home Page!</span></span>
      - <span class="string"><span class="content">http://example.org/</span></span>

  <span class="comment">#terms_of_use: true</span>
  <span class="comment"># If you want to provide your own, add app/views/site/tos.html.erb and then</span>
  <span class="comment"># provide /about/tos as the URL. </span>
  <span class="comment">#terms_of_service_url: http://en.gitorious.org/tos</span>
  <span class="comment">#privacy_policy_url: http://en.gitorious.org/privacy_policy</span>

  <span class="key">site_name</span>: <span class="string"><span class="content">My Git Repositories</span></span>

  <span class="key">favicon_url</span>: <span class="string"><span class="content">http://example.org/favicon.png</span></span>
  <span class="key">logo_url</span>: <span class="string"><span class="content">http://example.org/logo.png</span></span>
</pre></div>
</div>

<p>Make sure you have a <code>~/.ssh</code> directory with permissions set to <code>0700</code> and add
the authorized keys for your admins (NOTE: THIS WILL GIVE THEM FULL ACCESS TO
YOUR SHELL ACCOUNT)</p>

<p>Add the following to your <code>~/.bash_profile</code> and <code>~/.bashrc</code> script.</p>
<div class="CodeRay">
  <div class="code"><pre>export PATH=&quot;$HOME/git.example.com/script:$PATH&quot;
export RAILS_ENV=&quot;production&quot;
</pre></div>
</div>
<div class="CodeRay">
  <div class="code"><pre>gem install bundler
bundle install --path vendor/bundlerake db:migrate \
  RAILS_ENV=productionruby1.8 script/create_admin
</pre></div>
</div>

<p>Answer the questions</p>

<p>Login to your new installation</p>

<h2>A Note on SSH Keys</h2>

<p>I strongly recommend that you use a separate shell account on Dreamhost for
this setup for the following reason:</p>

<p>Gitorious will add SSH keys to your authorized keys files every time a user
adds an SSH public key. These are added with a forced command and some
meta-data about the user that added it. This has the consequence of forcing an
option on you.</p>

<p>If you use SSH keys to login normally then this will either prevent you from
logging in with that key (triggering the forced command) or alternatively
prevent you from being able to push to git repositories (by logging in
normally, rather than triggering the forced command). When added the keys will
looks like this in the authorized keys file:</p>
<div class="CodeRay">
  <div class="code"><pre>### START KEY 1 ###
command=&quot;gitorious admin&quot;,no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty ssh-rsa QXJlbid0IHlvdSBjcmFmdHk/IFRoaW5raW5nIEknZCB1c2UgcmVhbCBkYXRhIHNvbWV3aGVyZSBpbiBoZXJlLiBUZWUtaGVlLCBob3BlIHlvdSBlbmpveSB0aGlzLi4uIExvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQuIFF1aXNxdWUgcG9ydGEgbGVvIGluIHNlbSBkaWN0dW0gdXQgZWdlc3RhcyBmZWxpcyAgICAgICAgdmFyaXVzLiBQcmFlc2VudCB2ZXN0aWJ1bHVtIHRlbGx1cyBlZ2V0IG1hZ25hIHVsdHJpY2VzIGEgcG9ydHRpdG9yIG5pc2kgZWdlc3Rhcy4gTWF1cmlzIGRpY3R1bSBhdWd1ZSBldSBkaWFtIGNvbW1vZG8gZWdldCBjdXJzdXMgbGFjdXMgcHJldGl1bS4gTnVsbGEgZXVpc21vZCB0aW5jaWR1bnQgYW50ZSBzaXQgYW1ldCByaG9uY3VzLiBQZWxsZW50ZXNxdWUgICAgICAgc3VzY2lwaXQgZ3JhdmlkYSBsaWJlcm8sIHF1aXMgb3JuYXJlIGxlY3R1cyBhZGlwaXNjaW5nIHF1aXMuIFBoYXNlbGx1cyBncmF2aWRhIG5pc2kgdmVsIG5pc2wgZGlnbmlzc2ltIGJsYW5kaXQ= SshKey:1-User:1
### END KEY 1 ###
</pre></div>
</div>

<h2>Restarting the Application</h2>

<p>Changes to the configuration, CSS, or Javascript require a restart of the
application this can be done by cd&#39;ing into the git site&#39;s directory and
running the following commands:</p>
<div class="CodeRay">
  <div class="code"><pre>rm -f public/javascripts/all.js public/stylesheets/all.css
touch tmp/restart.txt
</pre></div>
</div>

    </div>
  </body>
</html>
