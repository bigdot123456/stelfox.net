<!DOCTYPE html>
<html lang='en_US'>
  <head>
    <title>Thoughts on IPv6 Security and Mitigation - Stelfox Athen&#xe6;um</title>

    <meta http-equiv='content-type' content='text/html; charset=utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1' />
    
    <meta name="keywords" content="networking, system-administration />

    <link rel="alternate" type="application/atom+xml" title="Stelfox Athen&#xe6;um Feed" href="/atom.xml" />
    <link rel="canonical" href="https://stelfox.net" />
    <link rel="author" href="https://plus.google.com/+SamStelfox31337/"/>

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Thoughts on IPv6 Security and Mitigation" />
    <meta property="og:url" content="https://stelfox.net/blog/2012/07/thoughts-on-ipv6-security-and-mitigation/" />
    <meta property="og:site_name" content="Stelfox Athen&#xe6;um" />
    <meta property="article:publisher" content="https://www.facebook.com/sstelfox" />
    <meta property="og:image" content="https://stelfox.net/static/avatar-01.jpg" />

    <link rel='stylesheet' href="//fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Alegreya+SC:700" />
    <link rel="stylesheet" href="/css/3HrCRVwL3Gos2V4HzXAw/Om/nxs=.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-32188490-1', 'stelfox.net');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header class='masthead'>
      <div class='masthead-inner'>
        <h1><a href='/' title='Home'>Sam Stelfox</a></h1>
        <p class='lead'>Thoughts from a systems hacker and developer.</p>
        <nav>
          <ul>
            <li><a href="/about/" title="About">About</a></li>
            <li><a href="/blog/" title="Blog">Blog</a></li>
            <li><a href="/knowledge_base/" title="Knowledge Base">Knowledge Base</a></li>
            <li><form action="/search/" method="get"><input type="search" name="q" placeholder="Search" /></form></li>
          </ul>
        </nav>
        <footer class='colophon'>
          <p>&copy; 2014, All rights reserved.</p>
        </footer>
      </div>
    </header>
    <div class='content container'>
      <div class='post'>
        <h1><a href="/blog/2012/07/thoughts-on-ipv6-security-and-mitigation/">Thoughts on IPv6 Security and Mitigation</a></h1>
        <aside class="post-date">Published <time datetime=''>in the middle of the night on July 21, 2012</time> by Sam Stelfox</aside>
        <article>
          <p>I setup IPv6 on my home network with an OpenWRT router and Hurricane Electric
and now I suddenly have an opinion on the state of IPv6 security. This is
something that I&#39;ve been meaning to do for some time and have been mulling over
in the back of my mind. I&#39;ll go over the details from start to finish of
setting up hurricane electric on the router in another post as the information
to do so is very scattered and disjointed. It does appear to be very well
documented on the OpenWRT wiki but I found that they leave out some very
important steps, so stay tuned for that.</p>

<p>Lets start with the loss of NAT. NAT was never intended to be a security
measure and lots of people will argue with me for saying that it was. However,
the truth of the matter is that any machine that is behind a NAT is not
directly addressable from the internet without someone on the inside
intentionally poking holes (even if that someone is a bad-guy).</p>

<p>Anyone technically knowledgeable enough can usually use fingerprints of how a
machine responds to different types of traffic both normal and unusual to
identify what operating system, version, and specific details about the
services and potential vulnerabilities of that machine. This information is
invaluable to attackers.</p>

<p>One of IPv6&#39;s biggest selling points (and one that I quite enjoy, don&#39;t
misunderstand this post) is that every device is addressable. This can
potentially allow attackers to learn more about what they&#39;re attacking.</p>

<p>So how do you counter this? Well firewalls can help quite a bit in thwarting OS
fingerprinting, but even the strongest firewall won&#39;t completely prevent this.
Another, more protective layer that IPv6 gives you for free is it&#39;s sheer size.</p>

<p>Doing a pure enumeration of a single home subnet remotely (that is you are not
on the link IPv6 local link) would take millennia by some estimations, as
opposed the the IPv4 address space which could be done at home in a matter of
weeks. One house vs the world. That is the scale we are now working at in IPv6.</p>

<p>The vast scale, however, while enough to defend against random scans, will not
prevent your address showing up in server logs that you connect to. A single
IPv6 address can be scanned just as easily as an IPv4 address.</p>

<p>What&#39;s more is that once an attacker has a presence on a subnet they can
enumerate every single machine on that network in a matter of seconds to
minutes. Since most home users are infected through drive by trojans, found in
emails, and websites that the user chooses to go to, and attackers are already
used to not having direct access to a machine from the internet, means the
slowness and difficulty of the raw scans just simply won&#39;t be an issue.</p>

<p>Due too the ease of enumerating local networks and that they probably contain
more vulnerable machines.... I&#39;ll leave that extrapolation as an exercise to my
readers. I do predict that infrastructure will become a larger target due to
this, just to collect their logs to attack home users.</p>

<p>The next thing that I want to bring up is IPv6, by default, uses the
interface&#39;s MAC address to generate the last 12 characters / 48 bits of the
IPv6 address. The rest of the local address consists of an identifier
indicating that the address was generated using a MAC address and was not
randomly generated.</p>

<p>So what does this actually tell us? Well if the OS and OS version can help up
specify attacks, why not the brand and possibly the model of the MAC address?
What attack vectors are waiting in the firmware of our ethernet and wireless
cards? Firmware that almost never gets updated, and is known to have bugs and
quirks?</p>

<p>That one is actually an easy one, RFC 3041 defines &quot;Privacy Addresses&quot;. These
are completely random local addresses that get generated once a day. Logs
become increasingly useless on the server end, there is a lot of decoys on
networks, and we&#39;re no longer exposing as much information to potential
hostiles.</p>

<p>I use Fedora 17 and it took me a while to figure out how to enable privacy
addresses the &quot;Red Hat&quot; way. You can easily do it generally on any Linux system
with sysctl. Just add the following to your /etc/sysctl.conf and reload sysctl:</p>
<div class="CodeRay">
  <div class="code"><pre>net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2
</pre></div>
</div>

<p>But that isn&#39;t the &quot;Red Hat&quot; way. Red Hat manages it&#39;s interfaces and network
configuration through various interface configuration files living in
/etc/sysconfig/network-scripts. For any IPv6 enabled interface you can turn on
privacy addresses with the following line for example in
&quot;/etc/sysconfig/network-scripts/ifcfg-eth0&quot;:</p>
<div class="CodeRay">
  <div class="code"><pre>IPV6_PRIVACY=&quot;rfc3041&quot;
</pre></div>
</div>

<p>After restarting your network interfaces they will additionally have privacy
addresses that will be change automatically. The interfaces still have the MAC
based addresses as well but they will not longer be the default and thus will
not show up in remote server logs.</p>

<p>Now, what would be a solid and strong step forward was a way to have a local
machine register it&#39;s privacy address with a local IDS/IPS with an expiration,
and to automatically trigger the IDS/IPS whenever a new connection is made to
an expired privacy address. It would almost be like a free honey pot on your
own network.</p>

        </article>
      </div>
    </div>
  </body>
</html>
