<!DOCTYPE html>
<html lang='en_US'>
  <head>
    <title>Fail Fast in Bash Scripts - Stelfox Athen&#xe6;um</title>

    <meta http-equiv='content-type' content='text/html; charset=utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1' />
    
    <meta name="keywords" content="cli, bash />

    <link rel="alternate" type="application/atom+xml" title="Stelfox Athen&#xe6;um Feed" href="/atom.xml" />
    <link rel="canonical" href="https://stelfox.net" />
    <link rel="author" href="https://plus.google.com/+SamStelfox31337/"/>

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Fail Fast in Bash Scripts" />
    <meta property="og:url" content="https://stelfox.net/blog/2013/11/fail-fast-in-bash-scripts/" />
    <meta property="og:site_name" content="Stelfox Athen&#xe6;um" />
    <meta property="article:publisher" content="https://www.facebook.com/sstelfox" />
    <meta property="og:image" content="https://stelfox.net/static/avatar-01.jpg" />

    <link rel='stylesheet' href="//fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Alegreya+SC:700" />
    <link rel="stylesheet" href="/css/3HrCRVwL3Gos2V4HzXAw/Om/nxs=.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-32188490-1', 'stelfox.net');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header class='masthead'>
      <div class='masthead-inner'>
        <h1><a href='/' title='Home'>Sam Stelfox</a></h1>
        <p class='lead'>Thoughts from a systems hacker and developer.</p>
        <nav>
          <ul>
            <li><a href="/about/" title="About">About</a></li>
            <li><a href="/blog/" title="Blog">Blog</a></li>
            <li><a href="/knowledge_base/" title="Knowledge Base">Knowledge Base</a></li>
            <li><form action="/search/" method="get"><input type="search" name="q" placeholder="Search" /></form></li>
          </ul>
        </nav>
        <footer class='colophon'>
          <p>&copy; 2014, All rights reserved.</p>
        </footer>
      </div>
    </header>
    <div class='content container'>
      <div class='post'>
        <h1><a href="/blog/2013/11/fail-fast-in-bash-scripts/">Fail Fast in Bash Scripts</a></h1>
        <aside class="post-date">Published <time datetime=''>instead of an afternoon nap on November 26, 2013</time> by Sam Stelfox</aside>
        <article>
          <p>I found myself writing another bash script that should exit should any of the
few commands within it fail to run. As I began writing some error handling
after each command, and isolating the sections into bash functions I figured
there had to be a better way. After a little Googling and a trip through the
bash manpages sure enough:</p>
<div class="CodeRay">
  <div class="code"><pre>#!/bin/bash

function error_handler() {
  echo &quot;Error occurred in script at line: ${1}.&quot;
  echo &quot;Line exited with status: ${2}&quot;
}

trap 'error_handler ${LINENO} $?' ERR

set -o errexit
set -o errtrace
set -o nounset

echo &quot;Everything is running fine...&quot;

# A command outside of a conditional that will always return a exit code of 1
test 1 -eq 0

echo &quot;This will never run, as a command has failed&quot;
echo &quot;Using unset variable ${TEST} will also cause this script to exit&quot;
</pre></div>
</div>

<p>The first piece of that is setting up an error handler that will get run
whenever an error condition occurs with the script. You can use this section to
roll back any changes or cleanup your environment as well as give you some
debug information about the failure.</p>

<p>I&#39;m then setting a few bash options, The following is a description taken more
or less directly from the bash man pages:</p>

<blockquote>
<p>-o errexit: Exit immediately if a pipeline (which may consist of a single
simple command), a subshell command enclosed in parentheses, or one of the
commands executed as part of a command list enclosed by braces exits with a
non-zero status.</p>

<p>-o errtrace: If set, any trap on ERR is inherited by shell functions, command
substitutions, and commands execute in a subshell environment.</p>

<p>-o nounset: Treat unset variables and parameters other than the special
parameters &quot;@&quot; and &quot;*&quot; as an error when performing parameter expansion.</p>
</blockquote>

<p>If anything goes wrong in the script it will fail once, fail fast, and let you
know where it died.</p>

        </article>
      </div>
    </div>
  </body>
</html>
